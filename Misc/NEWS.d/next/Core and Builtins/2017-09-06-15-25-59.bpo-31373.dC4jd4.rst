Fix several possible instances of undefined behavior due to floating-point
demotions.
